<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title data-translate-key="app_title">Typing Speed Challenge V7</title>
    <style>
        /* CSS Styling (Unver√§ndert) */
        body {
            font-family: 'Consolas', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #282c34;
            color: #abb2bf;
        }

        #container {
            width: 80%;
            max-width: 900px;
            padding: 40px;
            background-color: #3e4451;
            border-radius: 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.7);
        }

        /* Optionen / Einstellungsbereich */
        #options-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            border-bottom: 2px solid #61afef;
        }

        .option-group label {
            margin-right: 10px;
            font-size: 1em;
            color: #61afef;
        }

        /* Das Textfeld, das getippt werden muss */
        #text-to-type {
            font-size: 1.6em;
            line-height: 1.6;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #61afef;
            border-radius: 5px;
            background-color: #282c34;
            min-height: 120px;
            white-space: pre-wrap;
            user-select: none;
        }

        /* Hervorhebung f√ºr den aktuellen Buchstaben */
        .current {
            background-color: #c678dd;
            color: #282c34;
            border-radius: 2px;
            padding: 1px 0;
            display: inline-block;
            transform: scale(1.05);
        }

        /* Korrekt getippter Buchstabe */
        .correct {
            color: #98c379;
        }

        /* Falsch getippter Buchstabe */
        .incorrect {
            color: #e06c75;
            text-decoration: underline wavy #e06c75;
        }

        /* Das Eingabefeld */
        #input-field {
            width: 100%;
            padding: 15px;
            font-size: 1.3em;
            border: 2px solid #56b6c2;
            border-radius: 5px;
            box-sizing: border-box;
            background-color: #282c34;
            color: #ffffff;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }
        #input-field:focus {
            border-color: #c678dd;
            outline: none;
        }
        
        /* Status- und Ergebnis-Anzeige */
        #results {
            display: flex;
            justify-content: space-around;
            text-align: center;
            font-size: 1.3em;
            margin-top: 20px;
            padding: 15px 10px;
            border-top: 2px solid #61afef;
        }
        .stat {
            flex-grow: 1;
        }
        .stat span {
            display: block;
            font-size: 2.2em;
            font-weight: bold;
            color: #e6c07b;
            transition: color 0.3s;
        }

        button {
            background-color: #61afef;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.2em;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        button:hover {
            background-color: #56b6c2;
            transform: translateY(-1px);
        }
        button:active {
            transform: translateY(1px);
        }
    </style>
</head>
<body>

    <div id="container">
        <h1 data-translate-key="title">üöÄ Type Challenge</h1>
        
        <div id="options-bar">
            <div class="option-group">
                <label data-translate-key="language_label" for="language">Sprache:</label>
                <select id="language" onchange="loadLanguage(this.value)">
                    <option value="de">Deutsch</option>
                    <option value="en">English</option>
                    <option value="fr">Fran√ßais</option>
                    <option value="es">Espa√±ol</option>
                    <option value="it">Italiano</option> </select>
            </div>
            
            <div class="option-group">
                <label data-translate-key="category_label" for="difficulty">Textkategorie:</label>
                <select id="difficulty" onchange="startTest()">
                    <option value="short" data-translate-key="category_short">Kurz & Leicht</option>
                    <option value="long" data-translate-key="category_long">Lang & Komplex</option>
                    <option value="tech" data-translate-key="category_tech">Technisch/Code</option>
                </select>
            </div>
            <div id="info-message" style="color: #98c379;" data-translate-key="info_ready">Bereit f√ºr den Start!</div>
        </div>

        <div id="text-to-type"></div>

        <input type="text" id="input-field" data-translate-key="placeholder" placeholder="Beginne hier mit dem Tippen..." autofocus disabled>

        <div id="results">
            <div class="stat" data-translate-key="wpm">WPM<span id="wpm">0</span></div>
            <div class="stat" data-translate-key="accuracy">Genauigkeit<span id="accuracy">0%</span></div>
            <div class="stat" data-translate-key="time">Zeit<span id="time">0.00s</span></div>
        </div>
        
        <button onclick="startTest()" data-translate-key="new_text">Neuer Text / Neustart</button>
    </div>

    <script>
        /* ==================== */
        /* JavaScript Logic (V7 - 5 Sprachen) */
        /* ==================== */
        const textToTypeElement = document.getElementById('text-to-type');
        const inputField = document.getElementById('input-field');
        const wpmDisplay = document.getElementById('wpm');
        const accuracyDisplay = document.getElementById('accuracy');
        const timeDisplay = document.getElementById('time');
        const difficultySelect = document.getElementById('difficulty');
        const languageSelect = document.getElementById('language');
        const infoMessage = document.getElementById('info-message');

        let currentLang = 'en'; 

        // --- 1. √úbersetzungsobjekt (JSON) ---
        const translations = {
            'de': {
                'app_title': 'Tipp-Geschwindigkeits-Trainer',
                'title': 'üöÄ Type Challenge',
                'language_label': 'Sprache:',
                'category_label': 'Textkategorie:',
                'category_short': 'Kurz & Leicht',
                'category_long': 'Lang & Komplex',
                'category_tech': 'Technisch/Code',
                'wpm': 'WPM', 'accuracy': 'Genauigkeit', 'time': 'Zeit',
                'placeholder': 'Beginne hier mit dem Tippen...',
                'new_text': 'Neuer Text / Neustart',
                'info_ready': 'Bereit f√ºr den Start!',
                'info_loaded': (category) => `Text (${category}) geladen.`,
                'info_finished': 'Geschafft! Klicke auf "Neustart" f√ºr eine neue Challenge.',
                'alert_paste_blocked': '‚ùå Einf√ºgen (Paste) ist im Test nicht erlaubt!',
                'alert_finished': (wpm, accuracy, mistakes) => `üéâ Test beendet!\n\nDein Ergebnis:\n  WPM: ${wpm}\n  Genauigkeit: ${accuracy}\n  Gemachte Fehler: ${mistakes}`,
                'sampleTexts': {
                    short: ["HTML, CSS und JavaScript bilden das Fundament des modernen World Wide Web. HTML f√ºr die Struktur, CSS f√ºr das Design und JavaScript f√ºr die Interaktivit√§t und Logik.", "Die beste Methode, um seine Tippgeschwindigkeit zu verbessern, ist die t√§gliche Konzentration auf genaue Eingaben und das Vermeiden von Fehlern."],
                    long: ["Programmieren lernen ist wie eine neue Sprache zu lernen. Es erfordert Geduld, √úbung und das Verstehen von grundlegenden Regeln, um am Ende komplexe Anwendungen erstellen zu k√∂nnen, welche die Nutzer begeistern sollen.", "Die kontinuierliche Integration und kontinuierliche Bereitstellung sind moderne Softwareentwicklungspraktiken, die darauf abzielen, den Prozess der Freigabe neuer Software-Updates zu beschleunigen."],
                    tech: ["function greet(name) { console.log(`Hello, ${name}!`); } greet('World'); // Die Funktion wird aufgerufen.", "if (x === true && y != 0) { return x / (y * 2); } else { throw new Error('Invalid input'); }"]
                }
            },
            'en': {
                'app_title': 'Typing Speed Trainer',
                'title': 'üöÄ Type Challenge',
                'language_label': 'Language:',
                'category_label': 'Text Category:',
                'category_short': 'Short & Easy',
                'category_long': 'Long & Complex',
                'category_tech': 'Technical/Code',
                'wpm': 'WPM', 'accuracy': 'Accuracy', 'time': 'Time',
                'placeholder': 'Start typing here...',
                'new_text': 'New Text / Restart',
                'info_ready': 'Ready to start!',
                'info_loaded': (category) => `Text (${category}) loaded.`,
                'info_finished': 'Done! Click "Restart" for a new challenge.',
                'alert_paste_blocked': '‚ùå Pasting is not allowed in the test!',
                'alert_finished': (wpm, accuracy, mistakes) => `üéâ Test finished!\n\nYour result:\n  WPM: ${wpm}\n  Accuracy: ${accuracy}\n  Mistakes: ${mistakes}`,
                'sampleTexts': {
                    short: ["HTML, CSS, and JavaScript form the foundation of the modern World Wide Web. HTML for structure, CSS for design, and JavaScript for interactivity and logic.", "The best way to improve typing speed is daily focus on accuracy and avoiding mistakes, rather than just focusing on pure speed."],
                    long: ["Learning to program is like learning a new language. It requires patience, practice, and understanding basic rules to eventually build complex applications that users will love.", "Continuous integration and continuous delivery are modern software development practices aiming to accelerate the release process while minimizing the error rate, which is essential for large teams."],
                    tech: ["function greet(name) { console.log(`Hello, ${name}!`); } greet('World'); // The function is called.", "if (x === true && y != 0) { return x / (y * 2); } else { throw new Error('Invalid input'); }"]
                }
            },
            'fr': {
                'app_title': 'Entra√Æneur de Vitesse de Frappe',
                'title': 'üöÄ D√©fi de Dactylographie',
                'language_label': 'Langue:',
                'category_label': 'Cat√©gorie de Texte:',
                'category_short': 'Court & Facile',
                'category_long': 'Long & Complexe',
                'category_tech': 'Technique/Code',
                'wpm': 'MPM', 'accuracy': 'Pr√©cision', 'time': 'Temps',
                'placeholder': 'Commencez √† taper ici...',
                'new_text': 'Nouveau Texte / Red√©marrer',
                'info_ready': 'Pr√™t √† commencer !',
                'info_loaded': (category) => `Texte (${category}) charg√©.`,
                'info_finished': 'Termin√© ! Cliquez sur "Red√©marrer" pour un nouveau d√©fi.',
                'alert_paste_blocked': '‚ùå Le collage (Coller) n\'est pas autoris√© dans le test !',
                'alert_finished': (wpm, accuracy, mistakes) => `üéâ Test termin√© !\n\nVotre r√©sultat:\n  MPM: ${wpm}\n  Pr√©cision: ${accuracy}\n  Erreurs commises: ${mistakes}`,
                'sampleTexts': {
                    short: ["HTML, CSS et JavaScript forment la base du World Wide Web moderne. HTML pour la structure, CSS pour le design et JavaScript pour l'interactivit√© et la logique.", "La meilleure fa√ßon d'am√©liorer la vitesse de frappe est de se concentrer quotidiennement sur la pr√©cision et d'√©viter les erreurs, plut√¥t que sur la vitesse pure."],
                    long: ["Apprendre √† programmer, c'est comme apprendre une nouvelle langue. Cela demande de la patience, de la pratique et la compr√©hension des r√®gles de base pour pouvoir construire des applications complexes.", "L'int√©gration et la livraison continues sont des pratiques de d√©veloppement logiciel modernes visant √† acc√©l√©rer le processus de publication tout en minimisant le taux d'erreur, ce qui est essentiel pour les grandes √©quipes."],
                    tech: ["function saluer(nom) { console.log(`Bonjour, ${nom} !`); } saluer('Monde'); // La fonction est appel√©e.", "if (x === vrai && y != 0) { return x / (y * 2); } else { throw new Error('Entr√©e invalide'); }"]
                }
            },
            'es': {
                'app_title': 'Entrenador de Velocidad de Escritura',
                'title': 'üöÄ Desaf√≠o de Tipograf√≠a',
                'language_label': 'Idioma:',
                'category_label': 'Categor√≠a de Texto:',
                'category_short': 'Corto y F√°cil',
                'category_long': 'Largo y Complejo',
                'category_tech': 'T√©cnico/C√≥digo',
                'wpm': 'PPM', 'accuracy': 'Precisi√≥n', 'time': 'Tiempo',
                'placeholder': 'Empiece a escribir aqu√≠...',
                'new_text': 'Nuevo Texto / Reiniciar',
                'info_ready': '¬°Listo para empezar!',
                'info_loaded': (category) => `Texto (${category}) cargado.`,
                'info_finished': '¬°Terminado! Haz clic en "Reiniciar" para un nuevo desaf√≠o.',
                'alert_paste_blocked': '‚ùå ¬°Pegar no est√° permitido en la prueba!',
                'alert_finished': (wpm, accuracy, mistakes) => `üéâ ¬°Prueba terminada!\n\nTu resultado:\n  PPM: ${wpm}\n  Precisi√≥n: ${accuracy}\n  Errores cometidos: ${mistakes}`,
                'sampleTexts': {
                    short: ["HTML, CSS y JavaScript forman la base de la World Wide Web moderna. HTML para la estructura, CSS para el dise√±o y JavaScript para la interactividad y l√≥gica.", "La mejor manera de mejorar la velocidad de escritura es la concentraci√≥n diaria en la precisi√≥n y evitar errores, en lugar de centrarse solo en la velocidad pura."],
                    long: ["Aprender a programar es como aprender un nuevo idioma. Requiere paciencia, pr√°ctica y comprensi√≥n de las reglas b√°sicas para construir aplicaciones complejas que gustar√°n a los usuarios.", "La integraci√≥n continua y la entrega continua son pr√°cticas modernas de desarrollo de software que buscan acelerar el proceso de lanzamiento de software minimizando la tasa de error, esencial para grandes equipos."],
                    tech: ["function saludar(nombre) { console.log(`Hola, ${nombre}!`); } saludar('Mundo'); // La funci√≥n es llamada.", "if (x === verdadero && y != 0) { return x / (y * 2); } else { throw new Error('Entrada inv√°lida'); }"]
                }
            },
            // NEUE SPRACHE: ITALIENISCH (it)
            'it': {
                'app_title': 'Trainer di Velocit√† di Battitura',
                'title': 'üöÄ Sfida di Battitura',
                'language_label': 'Lingua:',
                'category_label': 'Categoria Testo:',
                'category_short': 'Breve e Facile',
                'category_long': 'Lungo e Complesso',
                'category_tech': 'Tecnico/Codice',
                'wpm': 'PPM', 'accuracy': 'Precisione', 'time': 'Tempo',
                'placeholder': 'Inizia a digitare qui...',
                'new_text': 'Nuovo Testo / Riavvia',
                'info_ready': 'Pronto per iniziare!',
                'info_loaded': (category) => `Testo (${category}) caricato.`,
                'info_finished': 'Fatto! Clicca "Riavvia" per una nuova sfida.',
                'alert_paste_blocked': '‚ùå Incollare non √® consentito nel test!',
                'alert_finished': (wpm, accuracy, mistakes) => `üéâ Test terminato!\n\nIl tuo risultato:\n  PPM: ${wpm}\n  Precisione: ${accuracy}\n  Errori commessi: ${mistakes}`,
                'sampleTexts': {
                    short: ["HTML, CSS e JavaScript costituiscono le fondamenta del World Wide Web moderno. HTML per la struttura, CSS per il design e JavaScript per l'interattivit√† e la logica.", "Il modo migliore per migliorare la velocit√† di battitura √® la concentrazione quotidiana sulla precisione e l'evitare errori, piuttosto che concentrarsi sulla velocit√† pura."],
                    long: ["Imparare a programmare √® come imparare una nuova lingua. Richiede pazienza, pratica e comprensione delle regole di base per costruire applicazioni complesse che piaceranno agli utenti.", "L'integrazione continua e la consegna continua sono pratiche di sviluppo software moderno volte ad accelerare il processo di rilascio minimizzando il tasso di errore, essenziale per i grandi team."],
                    tech: ["function saluta(nome) { console.log(`Ciao, ${nome}!`); } saluta('Mondo'); // La funzione viene chiamata.", "if (x === vero && y != 0) { return x / (y * 2); } else { throw new Error('Input non valido'); }"]
                }
            }
            // HIER K√ñNNEN DIE RESTLICHEN SPRACHEN FOLGEN
        };

        let currentText = '';
        let timer = null;
        let startTime = 0;
        let correctTypedCharacters = 0; 
        let totalTypedCharacters = 0;   
        let errorsMadeCount = 0;        
        let isRunning = false;

        // --- Automatisches Spracherkennung und Laden ---

        function getPreferredLanguage() {
            const browserLang = (navigator.language || navigator.userLanguage).substring(0, 2);
            if (translations[browserLang]) {
                return browserLang;
            }
            return 'en'; 
        }

        function loadLanguage(langCode) {
            currentLang = langCode;
            const langData = translations[langCode] || translations['en']; 
            
            document.querySelectorAll('[data-translate-key]').forEach(element => {
                const key = element.getAttribute('data-translate-key');
                const translation = langData[key];

                if (translation) {
                    if (element.tagName === 'INPUT' && element.hasAttribute('placeholder')) {
                        element.setAttribute('placeholder', translation);
                    } else if (element.tagName === 'TITLE') {
                        document.title = translation;
                    } else if (element.tagName === 'OPTION') {
                        element.textContent = translation;
                    } else if (typeof translation === 'string') {
                        element.textContent = translation;
                    }
                }
            });

            languageSelect.value = langCode;
            startTest();
        }

        // --- Setup und Start ---
        
        function loadText() {
            const difficulty = difficultySelect.value;
            const langData = translations[currentLang] || translations['en'];
            const texts = langData.sampleTexts[difficulty];
            
            currentText = texts[Math.floor(Math.random() * texts.length)];
            textToTypeElement.innerHTML = '';

            currentText.split('').forEach((char) => {
                const charSpan = document.createElement('span');
                charSpan.textContent = char;
                textToTypeElement.appendChild(charSpan);
            });
            textToTypeElement.children[0].classList.add('current');
            
            const categoryText = difficultySelect.options[difficultySelect.selectedIndex].textContent;
            infoMessage.textContent = langData.info_loaded(categoryText);
        }

        function startTest() {
            clearInterval(timer);
            isRunning = false;
            startTime = 0;
            
            correctTypedCharacters = 0;
            totalTypedCharacters = 0;
            errorsMadeCount = 0;
            
            wpmDisplay.textContent = '0';
            accuracyDisplay.textContent = '0%';
            timeDisplay.textContent = '0.00s';
            
            inputField.value = '';
            inputField.disabled = false;
            inputField.focus();

            loadText(); 
        }

        // --- Anti-Copy-Paste-Schutz (Angepasst f√ºr i18n) ---
        inputField.addEventListener('paste', (e) => {
            e.preventDefault();
            const langData = translations[currentLang] || translations['en'];
            infoMessage.textContent = langData.alert_paste_blocked;
            setTimeout(() => {
                infoMessage.textContent = langData.info_loaded(difficultySelect.options[difficultySelect.selectedIndex].textContent);
            }, 1500);
        });

        inputField.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });
        
        inputField.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'v') {
                e.preventDefault();
                const langData = translations[currentLang] || translations['en'];
                infoMessage.textContent = langData.alert_paste_blocked;
                setTimeout(() => {
                    infoMessage.textContent = langData.info_loaded(difficultySelect.options[difficultySelect.selectedIndex].textContent);
                }, 1500);
            }
        });
        
        // --- Hauptlogik beim Tippen ---

        inputField.addEventListener('input', (e) => {
            if (!isRunning) {
                isRunning = true;
                startTime = Date.now();
                timer = setInterval(() => {
                    if (isRunning) updateMetrics(true); 
                }, 100); 
            }

            const input = inputField.value;
            const targetChars = textToTypeElement.children;
            const newLength = input.length;
            
            if (newLength > totalTypedCharacters) {
                const lastTypedIndex = newLength - 1;
                if (input[lastTypedIndex] !== currentText[lastTypedIndex]) {
                    errorsMadeCount++; 
                }
            }
            
            totalTypedCharacters = newLength; 
            correctTypedCharacters = 0; 

            for (let i = 0; i < currentText.length; i++) {
                const targetChar = currentText[i];
                const typedChar = input[i];
                const charElement = targetChars[i];

                charElement.classList.remove('current', 'correct', 'incorrect');
                
                if (i < newLength) {
                    if (typedChar === targetChar) {
                        charElement.classList.add('correct');
                        correctTypedCharacters++; 
                    } else {
                        charElement.classList.add('incorrect');
                    }
                } else if (i === newLength && i < currentText.length) {
                    charElement.classList.add('current');
                }
            }
            
            updateMetrics(false); 

            if (newLength === currentText.length) {
                inputField.disabled = true;
                clearInterval(timer);
                isRunning = false;
                
                const langData = translations[currentLang] || translations['en'];
                infoMessage.textContent = langData.info_finished;

                const finalAccuracy = accuracyDisplay.textContent;
                const finalWPM = wpmDisplay.textContent;

                alert(langData.alert_finished(finalWPM, finalAccuracy, errorsMadeCount));
            }
        });

        // --- Metriken Berechnung ---
        function updateMetrics(onlyTime = false) {
            const timeElapsedInSeconds = (Date.now() - startTime) / 1000;
            
            timeDisplay.textContent = `${timeElapsedInSeconds.toFixed(2)}s`;

            if (onlyTime && !isRunning) return;

            if (totalTypedCharacters > 0 && timeElapsedInSeconds > 0) {
                const correctWords = correctTypedCharacters / 5;
                const minutes = timeElapsedInSeconds / 60;
                
                const wpm = Math.round(correctWords / minutes);
                
                const currentAccuracy = totalTypedCharacters > 0 
                    ? Math.round(((totalTypedCharacters - errorsMadeCount) / totalTypedCharacters) * 100)
                    : 0;

                wpmDisplay.textContent = wpm;
                accuracyDisplay.textContent = `${Math.max(0, currentAccuracy)}%`; 
            } else if (!onlyTime) {
                 wpmDisplay.textContent = '0';
                 accuracyDisplay.textContent = '0%';
            }
        }
        
        // --- Automatischer Start bei Seitenaufruf ---
        document.addEventListener('DOMContentLoaded', () => {
            const preferredLang = getPreferredLanguage();
            loadLanguage(preferredLang); 
        });
    </script>
</body>
</html>
